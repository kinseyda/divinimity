FROM node:24-trixie
WORKDIR /app

# Copy manifests for dependency installation
COPY package*.json ./
COPY backend/package*.json ./backend/
COPY shared/package*.json ./shared/

# Ensure dev deps are installed
ENV NODE_ENV=development

# Install only backend workspace deps
WORKDIR /app/backend
RUN npm install

# Copy the rest of the repo
WORKDIR /app
COPY . .

WORKDIR /app/backend
EXPOSE 3000
CMD ["npm", "run", "dev"]
